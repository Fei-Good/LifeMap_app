<template>
  <view class="profile-container">
<<<<<<< HEAD
=======
    <!-- èƒŒæ™¯è£…é¥° -->
    <view class="background-decoration">
      <view class="circle circle-1"></view>
      <view class="circle circle-2"></view>
      <view class="circle circle-3"></view>
    </view>
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
    <view class="top-nav">
      <view class="nav-back" @click="goBack">
        <text class="back-icon">â†</text>
        <text class="back-text">è¿”å›</text>
      </view>
      <view class="nav-title">
        <text class="title-text">ä¸ªäººèµ„æ–™</text>
      </view>
<<<<<<< HEAD
    </view>
    
    <view class="user-info">
      <view class="avatar-section">
=======
      <view class="nav-edit" @click="toggleEditMode">
        <text class="edit-text">{{ isEditMode ? 'ä¿å­˜' : 'ç¼–è¾‘' }}</text>
      </view>
    </view>
    
    <!-- ç”¨æˆ·å¤´åƒåŒºåŸŸ -->
    <view class="avatar-section">
      <view class="avatar-container">
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
        <image 
          class="user-avatar" 
          src="@/static/login/DouDouå½¢è±¡_ç™»å½•é¡µ.png" 
          mode="aspectFit"
        />
<<<<<<< HEAD
      </view>
      
      <view class="info-section">
        <view class="info-item">
          <text class="label">ç”¨æˆ·å</text>
          <text class="value">{{ currentUser?.username || 'æœªè®¾ç½®' }}</text>
        </view>
        
        <view class="info-item">
          <text class="label">æ‰‹æœºå·ç </text>
          <text class="value">{{ currentUser?.phone || 'æœªè®¾ç½®' }}</text>
        </view>
        
        <view class="info-item">
          <text class="label">æ³¨å†Œæ—¶é—´</text>
          <text class="value">{{ formatDate(currentUser?.createdAt) }}</text>
        </view>
        
        <view class="info-item">
          <text class="label">æœ€åç™»å½•</text>
          <text class="value">{{ formatDate(currentUser?.lastLoginAt) || 'ä»æœªç™»å½•' }}</text>
        </view>
      </view>
    </view>
    
    <view class="action-section">
      <button class="logout-btn" @click="handleLogout">
        <text>é€€å‡ºç™»å½•</text>
      </button>
=======
        <view class="avatar-edit" v-if="isEditMode" @click="changeAvatar">
          <text class="edit-icon">ğŸ“·</text>
        </view>
      </view>
      <text class="username">{{ currentUser?.username || 'ç”¨æˆ·å' }}</text>
      <text class="user-phone">{{ currentUser?.phone || 'æ‰‹æœºå·ç ' }}</text>
    </view>
    
    <!-- ç”¨æˆ·ä¿¡æ¯è¡¨å• -->
    <view class="info-section">
      <view class="info-group">
        <view class="info-label">
          <text class="label-text">ç”¨æˆ·å</text>
        </view>
        <input 
          v-if="isEditMode"
          class="info-input"
          v-model="editForm.username"
          placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
          maxlength="20"
        />
        <text v-else class="info-value">{{ currentUser?.username || 'æœªè®¾ç½®' }}</text>
      </view>
      
      <view class="info-group">
        <view class="info-label">
          <text class="label-text">æ‰‹æœºå·ç </text>
          <text class="optional">ï¼ˆé€‰å¡«ï¼‰</text>
        </view>
        <input 
          v-if="isEditMode"
          class="info-input"
          v-model="editForm.phone"
          type="number"
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ï¼ˆé€‰å¡«ï¼‰"
          maxlength="11"
        />
        <text v-else class="info-value">{{ currentUser?.phone || 'æœªè®¾ç½®' }}</text>
      </view>
      
      <view class="info-group">
        <view class="info-label">
          <text class="label-text">æ³¨å†Œæ—¶é—´</text>
        </view>
        <text class="info-value">{{ formatDate(currentUser?.createdAt) }}</text>
      </view>
      
      <view class="info-group">
        <view class="info-label">
          <text class="label-text">æœ€åç™»å½•</text>
        </view>
        <text class="info-value">{{ formatDate(currentUser?.lastLoginAt) || 'ä»æœªç™»å½•' }}</text>
      </view>
    </view>
    
    <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
    <view class="action-section">
      <button class="action-btn change-password-btn" @click="changePassword">
        <text class="btn-icon">ğŸ”’</text>
        <text class="btn-text">ä¿®æ”¹å¯†ç </text>
      </button>
      
      <button class="action-btn logout-btn" @click="handleLogout">
        <text class="btn-icon">ğŸšª</text>
        <text class="btn-text">é€€å‡ºç™»å½•</text>
      </button>
    </view>
    
    <!-- åº•éƒ¨è£…é¥° -->
    <view class="bottom-decoration">
      <view class="wave wave-1"></view>
      <view class="wave wave-2"></view>
      <view class="wave wave-3"></view>
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
    </view>
  </view>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import userService from '@/utils/userService'

<<<<<<< HEAD
const currentUser = ref(null)

=======
// å“åº”å¼æ•°æ®
const isEditMode = ref(false)
const currentUser = ref(null)
const editForm = ref({
  username: '',
  phone: ''
})

// ç”Ÿå‘½å‘¨æœŸ
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
onMounted(() => {
  loadCurrentUser()
})

<<<<<<< HEAD
const loadCurrentUser = () => {
  currentUser.value = userService.getCurrentUser()
=======
// æ–¹æ³•
const loadCurrentUser = () => {
  currentUser.value = userService.getCurrentUser()
  if (currentUser.value) {
    // åˆå§‹åŒ–ç¼–è¾‘è¡¨å•
    editForm.value.username = currentUser.value.username
    editForm.value.phone = currentUser.value.phone
  }
}

const toggleEditMode = async () => {
  if (isEditMode.value) {
    // ä¿å­˜æ¨¡å¼
    await saveProfile()
  } else {
    // ç¼–è¾‘æ¨¡å¼
    isEditMode.value = true
  }
}

const saveProfile = async () => {
  try {
    uni.showLoading({ title: 'ä¿å­˜ä¸­...' })
    
    const updates = {
      username: editForm.value.username,
      phone: editForm.value.phone
    }
    
    await userService.updateUserProfile(currentUser.value.id, updates)
    
    // é‡æ–°åŠ è½½ç”¨æˆ·ä¿¡æ¯
    loadCurrentUser()
    
    uni.hideLoading()
    uni.showToast({
      title: 'ä¿å­˜æˆåŠŸ',
      icon: 'success'
    })
    
    isEditMode.value = false
  } catch (error) {
    uni.hideLoading()
    uni.showToast({
      title: error.message || 'ä¿å­˜å¤±è´¥',
      icon: 'none'
    })
  }
}

const changeAvatar = () => {
  uni.showToast({
    title: 'å¤´åƒåŠŸèƒ½å¼€å‘ä¸­',
    icon: 'none'
  })
}

const changePassword = () => {
  uni.showModal({
    title: 'ä¿®æ”¹å¯†ç ',
    content: 'å¯†ç ä¿®æ”¹åŠŸèƒ½å¼€å‘ä¸­ï¼Œè¯·è”ç³»ç®¡ç†å‘˜',
    showCancel: false,
    confirmText: 'çŸ¥é“äº†'
  })
}

const handleLogout = () => {
  uni.showModal({
    title: 'ç¡®è®¤é€€å‡º',
    content: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
    success: (res) => {
      if (res.confirm) {
        userService.logout()
        uni.showToast({
          title: 'å·²é€€å‡ºç™»å½•',
          icon: 'success'
        })
        
        // è·³è½¬åˆ°ç™»å½•é¡µé¢
        setTimeout(() => {
          uni.reLaunch({
            url: '/pages/login/login'
          })
        }, 1500)
      }
    }
  })
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
}

const formatDate = (dateString) => {
  if (!dateString) return 'æœªè®¾ç½®'
  
  try {
    const date = new Date(dateString)
    return date.toLocaleDateString('zh-CN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    })
  } catch (e) {
    return 'æ—¥æœŸæ ¼å¼é”™è¯¯'
  }
}

<<<<<<< HEAD
const handleLogout = () => {
  uni.showModal({
    title: 'ç¡®è®¤é€€å‡º',
    content: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
    success: (res) => {
      if (res.confirm) {
        userService.logout()
        uni.showToast({
          title: 'å·²é€€å‡ºç™»å½•',
          icon: 'success'
        })
        
        setTimeout(() => {
          uni.reLaunch({
            url: '/pages/index/index'
          })
        }, 1500)
      }
    }
  })
}

const goBack = () => {
  uni.navigateBack()
=======
const goBack = () => {
  if (isEditMode.value) {
    // å¦‚æœæ­£åœ¨ç¼–è¾‘ï¼Œè¯¢é—®æ˜¯å¦ä¿å­˜
    uni.showModal({
      title: 'æç¤º',
      content: 'æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          isEditMode.value = false
          loadCurrentUser() // æ¢å¤åŸå§‹æ•°æ®
          uni.navigateBack()
        }
      }
    })
  } else {
    uni.navigateBack()
  }
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
}
</script>

<style lang="scss" scoped>
.profile-container {
  width: 100vw;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
<<<<<<< HEAD
=======
  overflow-x: hidden;
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
  padding: 0 40rpx;
  box-sizing: border-box;
}

<<<<<<< HEAD
.top-nav {
=======
/* èƒŒæ™¯è£…é¥° */
.background-decoration {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

.circle {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  animation: float 6s ease-in-out infinite;
}

.circle-1 {
  width: 300rpx;
  height: 300rpx;
  top: 10%;
  left: -150rpx;
  animation-delay: 0s;
}

.circle-2 {
  width: 200rpx;
  height: 200rpx;
  top: 60%;
  right: -100rpx;
  animation-delay: 2s;
}

.circle-3 {
  width: 150rpx;
  height: 150rpx;
  top: 30%;
  right: 20%;
  animation-delay: 4s;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
  }
}

/* é¡¶éƒ¨å¯¼èˆª */
.top-nav {
  position: relative;
  z-index: 10;
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
  display: flex;
  align-items: center;
  padding: 120rpx 0 40rpx 0;
}

.nav-back {
  display: flex;
  align-items: center;
  gap: 10rpx;
  padding: 20rpx;
<<<<<<< HEAD
=======
  cursor: pointer;
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
}

.back-icon {
  font-size: 36rpx;
  color: white;
  font-weight: bold;
}

.back-text {
  font-size: 28rpx;
  color: white;
}

.nav-title {
  flex: 1;
  text-align: center;
}

.title-text {
  font-size: 36rpx;
  color: white;
  font-weight: bold;
}

<<<<<<< HEAD
.user-info {
=======
.nav-edit {
  padding: 20rpx;
  cursor: pointer;
}

.edit-text {
  font-size: 28rpx;
  color: #ffd700;
  font-weight: 500;
}

/* ç”¨æˆ·å¤´åƒåŒºåŸŸ */
.avatar-section {
  position: relative;
  z-index: 2;
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 60rpx;
}

<<<<<<< HEAD
.avatar-section {
  margin-bottom: 40rpx;
}

.user-avatar {
  width: 160rpx;
  height: 160rpx;
  border-radius: 50%;
  border: 4rpx solid rgba(255, 255, 255, 0.3);
}

.info-section {
  width: 100%;
  max-width: 600rpx;
}

.info-item {
=======
.avatar-container {
  position: relative;
  margin-bottom: 30rpx;
}

.user-avatar {
  width: 200rpx;
  height: 200rpx;
  border-radius: 50%;
  box-shadow: 0 10rpx 30rpx rgba(0, 0, 0, 0.2);
  border: 4rpx solid rgba(255, 255, 255, 0.3);
}

.avatar-edit {
  position: absolute;
  bottom: 10rpx;
  right: 10rpx;
  width: 60rpx;
  height: 60rpx;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 5rpx 15rpx rgba(0, 0, 0, 0.2);
}

.edit-icon {
  font-size: 28rpx;
}

.username {
  font-size: 36rpx;
  color: white;
  font-weight: bold;
  margin-bottom: 15rpx;
}

.user-phone {
  font-size: 28rpx;
  color: rgba(255, 255, 255, 0.8);
}

/* ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ */
.info-section {
  width: 100%;
  max-width: 600rpx;
  z-index: 2;
  position: relative;
  margin-bottom: 60rpx;
}

.info-group {
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20rpx;
  padding: 30rpx;
  margin-bottom: 30rpx;
  backdrop-filter: blur(10px);
  border: 1rpx solid rgba(255, 255, 255, 0.2);
<<<<<<< HEAD
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.label {
  font-size: 28rpx;
  color: rgba(255, 255, 255, 0.8);
}

.value {
=======
}

.info-label {
  margin-bottom: 20rpx;
}

.label-text {
  font-size: 26rpx;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}

.optional {
  color: rgba(255, 255, 255, 0.5);
  margin-left: 8rpx;
  font-size: 22rpx;
  font-weight: normal;
}

.info-input {
  width: 100%;
  height: 80rpx;
  background: rgba(255, 255, 255, 0.9);
  border: 2rpx solid rgba(255, 255, 255, 0.3);
  border-radius: 15rpx;
  padding: 0 25rpx;
  font-size: 28rpx;
  color: #333;
  box-sizing: border-box;
  
  &:focus {
    border-color: #667eea;
    box-shadow: 0 3rpx 15rpx rgba(102, 126, 234, 0.2);
  }
}

.info-value {
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
  font-size: 30rpx;
  color: white;
  font-weight: 500;
}

<<<<<<< HEAD
.action-section {
  width: 100%;
  display: flex;
  justify-content: center;
=======
/* åŠŸèƒ½æŒ‰é’®åŒºåŸŸ */
.action-section {
  width: 100%;
  max-width: 600rpx;
  z-index: 2;
  position: relative;
  margin-bottom: 60rpx;
}

.action-btn {
  width: 100%;
  height: 100rpx;
  border: none;
  border-radius: 25rpx;
  font-size: 30rpx;
  font-weight: 600;
  transition: all 0.3s ease;
  margin-bottom: 30rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20rpx;
  
  &:hover {
    transform: translateY(-2rpx);
  }
  
  &:active {
    transform: translateY(0);
  }
}

.change-password-btn {
  background: rgba(255, 255, 255, 0.9);
  color: #667eea;
  border: 2rpx solid #667eea;
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
}

.logout-btn {
  background: rgba(255, 71, 87, 0.9);
  color: white;
<<<<<<< HEAD
  border: none;
  border-radius: 25rpx;
  padding: 30rpx 60rpx;
  font-size: 30rpx;
  font-weight: 600;
  transition: all 0.3s ease;
}

.logout-btn:active {
  transform: translateY(-2rpx);
=======
  border: 2rpx solid #ff4757;
}

.btn-icon {
  font-size: 32rpx;
}

.btn-text {
  font-size: 30rpx;
}

/* åº•éƒ¨è£…é¥° */
.bottom-decoration {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 200rpx;
  z-index: 1;
}

.wave {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100rpx;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 100% 100% 0 0;
  animation: wave 4s ease-in-out infinite;
}

.wave-1 {
  animation-delay: 0s;
}

.wave-2 {
  animation-delay: 1s;
  opacity: 0.7;
}

.wave-3 {
  animation-delay: 2s;
  opacity: 0.5;
}

@keyframes wave {
  0%, 100% {
    transform: translateX(0px);
  }
  50% {
    transform: translateX(20px);
  }
}

/* å“åº”å¼é€‚é… */
@media screen and (max-width: 375px) {
  .profile-container {
    padding: 0 30rpx;
  }
  
  .user-avatar {
    width: 160rpx;
    height: 160rpx;
  }
  
  .username {
    font-size: 32rpx;
  }
  
  .user-email {
    font-size: 26rpx;
  }
  
  .info-input {
    height: 70rpx;
    font-size: 26rpx;
  }
  
  .action-btn {
    height: 90rpx;
    font-size: 28rpx;
  }
>>>>>>> ef06d39 (feat: å®Œå–„æ³¨å†ŒåŠŸèƒ½ï¼Œä¼˜åŒ–æ ·å¼ï¼Œæ·»åŠ æ‰‹æœºå·ç å­—æ®µï¼Œä¿®å¤ç™»å½•è·³è½¬é—®é¢˜)
}
</style>
